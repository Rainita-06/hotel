{% extends "dashboard/base_dashboard.html" %}
{% block content %}
{% load static %}
<style>
@keyframes slide-in {
  0% { transform: translateX(100%); opacity: 0; }
  100% { transform: translateX(0); opacity: 1; }
}
.animate-slide-in {
  animation: slide-in 0.3s ease-out forwards;
  transition: all 0.5s ease;
}
</style>

<div class="w-full flex flex-col items-center py-8 space-y-6">

    <!-- Header Section -->
    <div class="w-[1184px] h-20 relative bg-white border-b border-gray-200">
        <div class="w-full h-12 left-[24px] top-[16px] inline-flex justify-between items-center">
            <div class="w-96 h-12 relative">
                <div class="w-96 h-8 left-0 top-0 absolute">
                    <div class="w-28 h-8 left-0 top-[1px] absolute justify-start text-gray-900 text-2xl font-bold font-['Inter']">Floors</div>
                </div>
                <div class="w-96 h-5 left-0 top-[32px] absolute">
                    <div class="w-96 h-5 left-0 top-[1px] absolute justify-start text-gray-600 text-sm font-normal font-['Inter']">
                        Manage property locations, buildings, floors, and areas
                    </div>
                </div>
            </div>
            <div class="w-80 h-10 flex justify-start items-center gap-4">
                <div class="w-64 h-10 relative">
                    <form method="GET" class="w-64 h-10 left-0 top-0 absolute bg-white rounded-lg outline outline-1 outline-offset-[-1px] outline-gray-200">
                        <input type="text"
                            name="search"
                            value="{{ search_query|default:'' }}"
                            placeholder="Search locations..."
                            class="w-full h-full bg-transparent border-none text-gray-700 text-base font-normal font-['Inter'] px-10 focus:outline-none">
                    </form>
                    <div class="w-4 h-6 left-[12px] top-[9px] absolute">
                        <div class="w-4 h-4 left-0 top-[4px] absolute inline-flex justify-center items-center">
                            <img src="{% static 'icon/search.svg'%}" class="w-4 h-4 relative bg-black/0 border-gray-200 overflow-hidden"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include "partials/location_tab.html" %}

    <!-- Floor Management Table -->
    <div class="w-[1184px] h-full relative bg-white rounded-xl shadow-[0px_1px_2px_0px_rgba(0,0,0,0.05)] outline outline-1 outline-offset-[-1px] outline-gray-200">

        <!-- Table Header -->
        <div class="w-full h-24 relative bg-black/0 border-b border-gray-200">
            <div class="w-[1086px] h-12 left-[24px] top-[24px] absolute bg-black/0 border-gray-200 inline-flex justify-between items-center">
                <div class="w-56 h-12 relative">
                    <div class="w-56 h-7 left-0 top-0 absolute">
                        <div class="w-48 h-7 left-0 top-[2px] absolute justify-start text-gray-900 text-xl font-semibold font-['Inter']">
                            Floor Management
                        </div>
                    </div>
                    <div class="w-96 h-5 left-0 top-[28px] absolute">
                        <div class="w-96 h-5 left-0 top-[1px] absolute justify-start text-gray-600 text-sm font-normal font-['Inter']">
                            Manage floors across all buildings
                        </div>
                    </div>
                </div><div class="flex items-center gap-4">
                <div class="w-32 h-10 px-4 py-2 bg-sky-600 rounded-lg border-gray-200 flex justify-start items-center gap-2">
                    <div class="w-3.5 h-6 relative">
                        <div class="w-3.5 h-4 left-0 top-[4px] absolute inline-flex justify-center items-center">
                            <img src="{% static 'icon/plus.svg'%}" class="w-3.5 h-4 relative bg-black/0 border-gray-200 overflow-hidden"/>
                        </div>
                    </div>
                    <div class="w-20 h-6 relative">
                        <a href="{% url 'floor_form' %}" class="inline-flex items-center justify-center w-20 h-6 rounded text-white text-base font-normal font-['Inter']">
                            Add Floor
                        </a>
                    </div>
                </div> 
                <form method="POST" action="{% url 'bulk_import_floors' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <label class="flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white text-base font-medium px-3 py-2 rounded-lg cursor-pointer transition">
            <img src="{% static 'icon/import.svg' %}" class="w-4 h-4" alt="Import">
            <span>Import</span>
            <input type="file" name="csv_file" class="hidden" onchange="this.form.submit()">
        </label>
    </form></div>{% if messages %}
  <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2">
    {% for message in messages %}
      {% if 'floor_import' in message.tags %}
        <div class="toast-message p-3 rounded text-white shadow-lg animate-slide-in
            {% if 'success' in message.tags %}bg-green-500{% else %}bg-red-500{% endif %}">
          {{ message }}
        </div>
      {% endif %}
    {% endfor %}
  </div>
{% endif %}


            </div>
        </div>

        <!-- Table Structure -->
        <div class="w-full relative bg-black/0 border-gray-200 overflow-x-auto">

            <!-- Table Columns Header -->
            <div class="w-full min-w-[1134px] h-12 bg-neutral-50 border-b border-gray-200 flex">
                <div class="w-64 flex items-center px-6">
                    <div class="text-gray-600 text-xs font-medium font-['Inter'] tracking-wide">Floor</div>
                </div>
                <div class="w-60 flex items-center px-6">
                    <div class="text-gray-600 text-xs font-medium font-['Inter'] tracking-wide">Building</div>
                </div>
                <!-- Move Actions to Right End -->
                <div class="flex-grow"></div>
                <div class="w-40 flex items-center px-6 justify-end">
                    <div class="text-gray-600 text-xs font-medium font-['Inter'] tracking-wide">Actions</div>
                </div>
            </div>

            <!-- Table Rows -->
            <div class="w-full min-w-[1134px] relative bg-black/0 border-gray-200">
                {% for floor in floors %}
                <div class="w-full h-16 border-b border-gray-200 flex items-center">
                    <!-- Floor Column -->
                    <div class="w-64 h-full flex items-center px-6">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-sky-600/10 rounded-lg flex justify-center items-center">
                                <div class="w-1.5 h-5 justify-start text-sky-600 text-sm font-medium font-['Inter']">{{ forloop.counter }}</div>
                            </div>
                            <div class="flex flex-col">
                                <div class="text-gray-900 text-sm font-medium font-['Inter']">{{ floor.floor_name }}</div>
                                <div class="text-gray-600 text-xs font-normal font-['Inter']">{{ floor.description }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Building Column -->
                    <div class="w-60 h-full flex items-center px-6">
                        <div class="text-gray-600 text-sm font-normal font-['Inter']">{{ floor.building.name }}</div>
                    </div>

                    <!-- Spacer -->
                    <div class="flex-grow"></div>

                    <!-- Actions Column (Moved to Right End) -->
                    <div class="w-40 h-full flex items-center px-6 justify-end gap-4">
                        <a href="{% url 'floor_edit' floor.floor_id %}" title="Edit">
                            <img src="{% static 'icon/edit.svg'%}" class="w-3.5 h-4 text-gray-500 hover:text-sky-600 cursor-pointer"/>
                        </a>
                        <a href="{% url 'floor_delete' floor.floor_id %}" title="Delete" onclick="return confirm('Are you sure you want to delete this floor?')">
                            <img src="{% static 'icon/delete.svg'%}" class="w-3.5 h-4 text-gray-500 hover:text-red-600 cursor-pointer"/>
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination Footer -->
            {% if floors.paginator.count > 0 %}
                <div class="h-16 bg-white border-t border-gray-200 flex items-center justify-between px-6">
                    <div class="text-neutral-500 text-sm font-normal font-['Inter']">
                        Showing {{ floors.start_index }} to {{ floors.end_index }} of {{ floors.paginator.count }} results
                    </div>
                    <div class="flex items-center gap-2">
                        {% if floors.has_previous %}
                            <a href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ floors.previous_page_number }}"
                               class="px-4 h-9 flex items-center justify-center bg-white rounded-lg border border-gray-200 text-gray-600 text-sm font-normal font-['Inter'] hover:bg-gray-50">
                                Previous
                            </a>
                        {% else %}
                            <div class="px-4 h-9 flex items-center justify-center bg-gray-100 rounded-lg text-gray-400 text-sm font-normal font-['Inter'] cursor-not-allowed">
                                Previous
                            </div>
                        {% endif %}

                        {% for num in floors.paginator.page_range %}
                            {% if num > floors.number|add:'-3' and num < floors.number|add:'3' %}
                                {% if num == floors.number %}
                                    <div class="w-9 h-9 flex items-center justify-center bg-sky-600 text-white rounded-lg text-sm font-normal font-['Inter']">{{ num }}</div>
                                {% else %}
                                    <a href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ num }}"
                                       class="w-9 h-9 flex items-center justify-center bg-white rounded-lg border border-gray-200 text-gray-600 text-sm font-normal font-['Inter'] hover:bg-gray-50">
                                        {{ num }}
                                    </a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}

                        {% if floors.has_next %}
                            <a href="?{% if request.GET.urlencode %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ floors.next_page_number }}"
                               class="px-4 h-9 flex items-center justify-center bg-white rounded-lg border border-gray-200 text-gray-600 text-sm font-normal font-['Inter'] hover:bg-gray-50">
                                Next
                            </a>
                        {% else %}
                            <div class="px-4 h-9 flex items-center justify-center bg-gray-100 rounded-lg text-gray-400 text-sm font-normal font-['Inter'] cursor-not-allowed">
                                Next
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
<script>
  // Auto-hide toast messages after 4 seconds
  document.addEventListener('DOMContentLoaded', () => {
    const toasts = document.querySelectorAll('.toast-message');
    toasts.forEach((toast) => {
      setTimeout(() => {
        toast.classList.add('opacity-0', 'translate-x-4'); // fade and move
        setTimeout(() => toast.remove(), 500); // remove from DOM
      }, 4000);
    });
  });
</script>
{% endblock %}
