{% extends "dashboard/base_dashboard.html" %}
{% load static %}

{% block head %}
{{ block.super }}
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<style>
    /* Custom styles to prevent layout shifts before AOS initializes */
    [data-aos] {
        opacity: 0;
        transition-property: opacity, transform;
    }
    
    /* Custom card styles */
    .stat-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Chart container */
    .chart-container {
        position: relative;
        height: 300px;
    }
    
    /* Activity feed */
    .activity-item {
        transition: background-color 0.2s ease;
    }
    
    .activity-item:hover {
        background-color: #f9fafb;
    }
    
    /* Progress bars */
    .progress-bar {
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        border-radius: 4px;
    }
</style>
{% endblock head %}

{% block content %}
<div class="bg-gray-50/50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <header class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 mb-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Analytics Dashboard</h1>
                    <p class="mt-1 text-sm text-gray-600">Detailed insights and trends for informed decision making</p>
                </div>
                <div class="flex items-center gap-3 mt-4 md:mt-0">
                    <button class="flex items-center justify-center gap-2 h-10 px-4 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50">
                        <span>Last 30 days</span>
                        <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0L5.23 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <button class="flex items-center gap-2 h-10 px-4 text-sm font-medium text-white bg-sky-600 rounded-lg hover:bg-sky-700">
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                           <path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.905 3.129V2.75z" />
                           <path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" />
                        </svg>
                        <span>Export</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 stat-card" data-aos="fade-up">
                <div class="flex items-center">
                    <div class="p-3 bg-blue-100 rounded-lg">
                        <svg class="w-6 h-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Total Tickets</p>
                        <p class="text-2xl font-semibold text-gray-900">{{ total_tickets }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 stat-card" data-aos="fade-up" data-aos-delay="100">
                <div class="flex items-center">
                    <div class="p-3 bg-green-100 rounded-lg">
                        <svg class="w-6 h-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" />
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Total Reviews</p>
                        <p class="text-2xl font-semibold text-gray-900">{{ total_reviews }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 stat-card" data-aos="fade-up" data-aos-delay="200">
                <div class="flex items-center">
                    <div class="p-3 bg-yellow-100 rounded-lg">
                        <svg class="w-6 h-6 text-yellow-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Avg Rating</p>
                        <p class="text-2xl font-semibold text-gray-900">{{ avg_rating }}/5</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 stat-card" data-aos="fade-up" data-aos-delay="300">
                <div class="flex items-center">
                    <div class="p-3 bg-purple-100 rounded-lg">
                        <svg class="w-6 h-6 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Completion Rate</p>
                        <p class="text-2xl font-semibold text-gray-900">{{ completion_rate }}%</p>
                    </div>
                </div>
            </div>
        </div>

        <nav class="mb-6">
            <div class="border-b border-gray-200">
                <div class="flex space-x-8">
                    <a href="#" class="py-2 px-1 border-b-2 border-sky-600 text-sm font-medium text-sky-600">Trends Over Time</a>
                    <a href="#" class="py-2 px-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700">Busiest Hours</a>
                    <a href="#" class="py-2 px-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700">Property Comparison</a>
                    <a href="#" class="py-2 px-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700">Reports</a>
                </div>
            </div>
        </nav>
        
        <div class="space-y-6">

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200" data-aos="fade-up">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900">Ticket Volume Trends</h2>
                            <p class="text-sm text-gray-600">30-day rolling average</p>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-gray-600">
                            <span class="w-3 h-3 bg-sky-600 rounded-full"></span>
                            Tickets
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="ticketTrendsChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200" data-aos="fade-up" data-aos-delay="100">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900">Feedback Volume Trends</h2>
                            <p class="text-sm text-gray-600">30-day rolling average</p>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-gray-600">
                            <span class="w-3 h-3 bg-teal-500 rounded-full"></span>
                            Feedback
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="feedbackTrendsChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200" data-aos="fade-up">
                <div class="flex flex-col md:flex-row justify-between items-start mb-4">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-900">Guest Satisfaction Score Over Time</h2>
                        <p class="text-sm text-gray-600">Average rating with confidence intervals</p>
                    </div>
                    <div class="flex items-center gap-4 text-xs text-gray-600 mt-2 md:mt-0">
                        <div class="flex items-center gap-2"><span class="w-3 h-3 bg-green-500 rounded-full"></span>Satisfaction Score</div>
                        <div class="flex items-center gap-2"><span class="w-3 h-3 bg-gray-300 rounded-full"></span>Confidence Band</div>
                    </div>
                </div>
                <div class="chart-container" style="height: 320px;">
                    <canvas id="satisfactionChart"></canvas>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Top Departments -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200" data-aos="fade-up">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Top Performing Departments</h2>
                    <div class="space-y-4">
                        {% for dept in top_departments %}
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium text-gray-900">{{ dept.name }}</p>
                                <div class="flex items-center text-sm text-gray-600">
                                    <span>{{ dept.satisfaction }}/5</span>
                                    <svg class="w-4 h-4 text-yellow-400 ml-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                    </svg>
                                </div>
                            </div>
                            <div class="w-24">
                                <div class="progress-bar bg-gray-200">
                                    <div class="progress-fill bg-green-500" style="width: {{ dept.satisfaction|floatformat:0 }}0%"></div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <p class="text-gray-500 text-center py-4">No department data available</p>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Recent Tickets -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 lg:col-span-2" data-aos="fade-up" data-aos-delay="100">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Recent Tickets</h2>
                    <div class="overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ticket</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for ticket in recent_tickets %}
                                <tr class="activity-item">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#{{ ticket.id }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ ticket.request_type.name|default:"N/A" }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ ticket.department.name|default:"N/A" }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                            {% if ticket.status == 'completed' %}bg-green-100 text-green-800
                                            {% elif ticket.status == 'in_progress' %}bg-yellow-100 text-yellow-800
                                            {% elif ticket.status == 'pending' %}bg-blue-100 text-blue-800
                                            {% else %}bg-gray-100 text-gray-800
                                            {% endif %}">
                                            {{ ticket.status|title }}
                                        </span>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">
                                        No recent tickets found
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200" data-aos="fade-up">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-900">Department Performance</h2>
                        <p class="text-sm text-gray-600">Avg resolution time vs satisfaction</p>
                    </div>
                    <div class="chart-container mt-4">
                        <canvas id="departmentPerformanceChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200" data-aos="fade-up" data-aos-delay="100">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-900">Room Type Feedback Distribution</h2>
                        <p class="text-sm text-gray-600">Satisfaction by room category</p>
                    </div>
                    <div class="chart-container mt-4">
                        <canvas id="roomFeedbackChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200" data-aos="fade-up">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-900">Scheduled Reports</h2>
                        <p class="text-sm text-gray-600">Automated analytics reports and notifications</p>
                    </div>
                    <button class="flex items-center gap-2 h-10 px-4 text-sm font-medium text-white bg-sky-600 rounded-lg hover:bg-sky-700">
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                           <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                        </svg>
                        <span>New Report</span>
                    </button>
                </div>

                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                    <div class="xl:col-span-2 space-y-4">
                        <h3 class="font-medium text-gray-900">Active Reports</h3>
                        {% for report in scheduled_reports %}
                        <div class="flex items-center justify-between p-4 border rounded-lg">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 flex-shrink-0 bg-sky-100 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-sky-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                      <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9.75h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5-13.5h16.5M3.75 6a2.25 2.25 0 012.25-2.25h12a2.25 2.25 0 012.25 2.25v12a2.25 2.25 0 01-2.25 2.25h-12a2.25 2.25 0 01-2.25-2.25V6z" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900">{{ report.name }}</p>
                                    <p class="text-sm text-gray-600">{{ report.schedule }}{% if report.next_run %} &bull; Next: {{ report.next_run|date:"M d, Y" }}{% endif %}</p>
                                </div>
                            </div>
                            <span class="text-xs font-medium px-2.5 py-0.5 rounded-full
                                {% if report.status == 'Active' %} bg-green-100 text-green-800
                                {% elif report.status == 'Paused' %} bg-yellow-100 text-yellow-800
                                {% else %} bg-gray-100 text-gray-800
                                {% endif %}">
                                {{ report.status }}
                            </span>
                        </div>
                        {% empty %}
                        <div class="text-center py-8 border-2 border-dashed rounded-lg">
                            <p class="text-sm text-gray-500">No active reports found.</p>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="space-y-4">
                        <h3 class="font-medium text-gray-900">Quick Templates</h3>
                        {% for template in quick_templates %}
                        <div class="p-4 border rounded-lg hover:bg-gray-50 cursor-pointer">
                            <p class="font-medium text-sm text-gray-900">{{ template.name }}</p>
                            <p class="text-xs text-gray-600">{{ template.description }}</p>
                        </div>
                        {% empty %}
                        <div class="text-center py-8 border-2 border-dashed rounded-lg">
                            <p class="text-sm text-gray-500">No templates available.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    // Initialize AOS
    AOS.init({
        duration: 800, // animation duration in ms
        once: true,    // whether animation should happen only once - while scrolling down
    });

    // --- Chart.js Configuration ---

    // Parse the JSON data from the Django backend
    const ticketTrendsData = JSON.parse('{{ ticket_trends|escapejs }}');
    const ticketDatesData = JSON.parse('{{ ticket_dates|escapejs }}');
    const feedbackTrendsData = JSON.parse('{{ feedback_trends|escapejs }}');
    const feedbackDatesData = JSON.parse('{{ feedback_dates|escapejs }}');
    const satisfactionScoresData = JSON.parse('{{ satisfaction_scores|escapejs }}');
    const satisfactionWeeksData = JSON.parse('{{ satisfaction_weeks|escapejs }}');
    const deptPerformanceData = JSON.parse('{{ dept_performance|escapejs }}');
    const roomFeedbackData = JSON.parse('{{ room_feedback|escapejs }}');

    // Ticket Volume Trends Chart
    const ticketCtx = document.getElementById('ticketTrendsChart').getContext('2d');
    const ticketChart = new Chart(ticketCtx, {
        type: 'line',
        data: {
            labels: ticketDatesData,
            datasets: [{
                label: 'Tickets',
                data: ticketTrendsData,
                borderColor: '#0284c7',
                backgroundColor: 'rgba(2, 132, 199, 0.1)',
                tension: 0.4,
                fill: true,
                pointBackgroundColor: '#0284c7',
                pointBorderColor: '#fff',
                pointHoverRadius: 6,
                pointRadius: 4,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { color: '#e5e7eb' }, ticks: { color: '#6b7280', stepSize: 5 } },
                x: { grid: { display: false }, ticks: { color: '#6b7280', maxRotation: 45, minRotation: 45 } }
            }
        }
    });

    // Feedback Volume Trends Chart
    const feedbackCtx = document.getElementById('feedbackTrendsChart').getContext('2d');
    const feedbackChart = new Chart(feedbackCtx, {
        type: 'line',
        data: {
            labels: feedbackDatesData,
            datasets: [{
                label: 'Feedback',
                data: feedbackTrendsData,
                borderColor: '#14b8a6',
                backgroundColor: 'rgba(20, 184, 166, 0.1)',
                tension: 0.4,
                fill: true,
                pointBackgroundColor: '#14b8a6',
                pointBorderColor: '#fff',
                pointHoverRadius: 6,
                pointRadius: 4,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { color: '#e5e7eb' }, ticks: { color: '#6b7280', stepSize: 10 } },
                x: { grid: { display: false }, ticks: { color: '#6b7280', maxRotation: 45, minRotation: 45 } }
            }
        }
    });

    // Guest Satisfaction Score Over Time Chart
    const satisfactionCtx = document.getElementById('satisfactionChart').getContext('2d');
    const satisfactionChart = new Chart(satisfactionCtx, {
        type: 'line',
        data: {
            labels: satisfactionWeeksData,
            datasets: [{
                label: 'Satisfaction Score',
                data: satisfactionScoresData,
                borderColor: '#22c55e',
                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                tension: 0.4,
                fill: true,
                pointBackgroundColor: '#22c55e',
                pointBorderColor: '#fff',
                pointHoverRadius: 6,
                pointRadius: 4,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, max: 5, grid: { color: '#e5e7eb' }, ticks: { color: '#6b7280', stepSize: 0.5 } },
                x: { grid: { display: false }, ticks: { color: '#6b7280' } }
            }
        }
    });

    // Department Performance Chart
    const deptCtx = document.getElementById('departmentPerformanceChart').getContext('2d');
    const deptLabels = deptPerformanceData.map(item => item.name);
    const resolutionTimes = deptPerformanceData.map(item => item.resolution_time);
    const satisfactionScores = deptPerformanceData.map(item => item.satisfaction);

    const deptChart = new Chart(deptCtx, {
        type: 'bar',
        data: {
            labels: deptLabels,
            datasets: [
                {
                    label: 'Resolution Time (hours)',
                    data: resolutionTimes,
                    backgroundColor: '#38bdf8', // lighter blue
                    borderColor: '#0284c7',
                    borderWidth: 1,
                    borderRadius: 4,
                    yAxisID: 'y'
                },
                {
                    label: 'Satisfaction Score',
                    data: satisfactionScores,
                    backgroundColor: '#86efac', // lighter green
                    borderColor: '#22c55e',
                    borderWidth: 1,
                    borderRadius: 4,
                    yAxisID: 'y1',
                    type: 'line', // You can make one a line on a combo chart
                    tension: 0.2,
                    fill: false,
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: true, position: 'top' } },
            scales: {
                y: { beginAtZero: true, position: 'left', title: { display: true, text: 'Resolution Time (hours)' } },
                y1: { beginAtZero: true, position: 'right', title: { display: true, text: 'Satisfaction Score' }, grid: { drawOnChartArea: false }, max: 5 },
                x: { grid: { display: false } }
            }
        }
    });

    // Room Type Feedback Distribution Chart
    const roomCtx = document.getElementById('roomFeedbackChart').getContext('2d');
    const roomLabels = roomFeedbackData.map(item => item.type);
    const roomSatisfaction = roomFeedbackData.map(item => item.satisfaction);

    const roomChart = new Chart(roomCtx, {
        type: 'bar',
        data: {
            labels: roomLabels,
            datasets: [{
                label: 'Satisfaction Score',
                data: roomSatisfaction,
                backgroundColor: ['#fde68a', '#fcd34d', '#fbbf24', '#f59e0b', '#d97706'],
                borderColor: '#b45309',
                borderWidth: 1,
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: 'y', // Makes it a horizontal bar chart
            plugins: { legend: { display: false } },
            scales: {
                y: { grid: { display: false }, ticks: { color: '#6b7280' } },
                x: { beginAtZero: true, max: 5, grid: { color: '#e5e7eb' }, ticks: { color: '#6b7280', stepSize: 1 } }
            }
        }
    });
</script>
{% endblock content %}