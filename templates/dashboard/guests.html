
{% extends "dashboard/base_dashboard.html" %}
{% load static %}

{% block title %}Guest Management - Dashboard{% endblock %}

{% block dashboard_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold">Guest Management</h2>
  <a href="{% url 'dashboard:register_guest' %}" class="btn btn-primary">
    <i class="bi bi-person-plus"></i> Register New Guest
  </a>
</div>

<!-- Search and Filter Section -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <form method="GET" class="row g-3">
      <div class="col-md-4">
        <label for="search" class="form-label">Search Guests</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-search"></i></span>
          <input type="text" class="form-control" id="search" name="search" 
                 value="{{ search }}" placeholder="Search by name, email, room...">
        </div>
      </div>
      <div class="col-md-2">
        <label for="breakfast_filter" class="form-label">Breakfast</label>
        <select class="form-select" id="breakfast_filter" name="breakfast_filter">
          <option value="" {% if not breakfast_filter %}selected{% endif %}>All</option>
          <option value="yes" {% if breakfast_filter == 'yes' %}selected{% endif %}>Included</option>
          <option value="no" {% if breakfast_filter == 'no' %}selected{% endif %}>Not Included</option>
        </select>
      </div>
      <div class="col-md-2">
        <label for="status_filter" class="form-label">Status</label>
        <select class="form-select" id="status_filter" name="status_filter">
          <option value="" {% if not status_filter %}selected{% endif %}>All</option>
          <option value="current" {% if status_filter == 'current' %}selected{% endif %}>Current</option>
          <option value="past" {% if status_filter == 'past' %}selected{% endif %}>Past</option>
          <option value="future" {% if status_filter == 'future' %}selected{% endif %}>Future</option>
        </select>
      </div>
      <div class="col-md-2">
        <label for="qr_filter" class="form-label">QR Code</label>
        <select class="form-select" id="qr_filter" name="qr_filter">
          <option value="" {% if not qr_filter %}selected{% endif %}>All</option>
          <option value="with_qr" {% if qr_filter == 'with_qr' %}selected{% endif %}>With QR</option>
          <option value="without_qr" {% if qr_filter == 'without_qr' %}selected{% endif %}>Without QR</option>
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label">&nbsp;</label>
        <div class="d-grid">
          <button type="submit" class="btn btn-outline-primary">
            <i class="fas fa-filter me-1"></i>Filter
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Guest ID</th>
            <th>Name</th>
            <th>Room</th>
            <th>Check-in</th>
            <th>Check-out</th>
            <th>Breakfast</th>
            <th>Vouchers</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for guest in guests %}
          <tr>
            <td>
              <span class="badge bg-secondary"
                >{{ guest.guest_id|default:"Auto" }}</span
              >
            </td>
            <td>
              <strong>{{ guest.full_name }}</strong><br />
              <small class="text-muted">{{ guest.email }}</small>
            </td>
            <td><span class="badge bg-info">{{ guest.room_number }}</span></td>
            <td>
              {% if guest.checkin_date %}
                {{ guest.checkin_date|date:"M d, Y" }}
              {% else %}
                <span class="text-muted">Not set</span>
              {% endif %}
            </td>
            <td>
              {% if guest.checkout_date %}
                {{ guest.checkout_date|date:"M d, Y" }}
              {% else %}
                <span class="text-muted">Not set</span>
              {% endif %}
            </td>
            <td>
              {% if guest.breakfast_included %}
              <span class="badge bg-success">Included</span>
              {% else %}
              <span class="badge bg-secondary">Not Included</span>
              {% endif %}
            </td>
            <td>
              <span class="badge bg-primary">{{ guest.vouchers.count }}</span>
            </td>
            <td>
              <a
                href="{% url 'dashboard:guest_detail' guest.id %}"
                class="btn btn-sm btn-outline-primary"
              >
                <i class="bi bi-eye"></i> View
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8" class="text-center py-5">
              <div class="text-muted">
                <i class="bi bi-people fs-1"></i>
                <p>No guests registered yet.</p>
                <a
                  href="{% url 'dashboard:register_guest' %}"
                  class="btn btn-primary"
                  >Register First Guest</a
                >
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
