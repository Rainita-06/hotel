{% extends "dashboard/base_dashboard.html" %}
{% load static %}

{% block content %}
<style>
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-up {
        animation: fadeInUp 0.6s ease-out forwards;
        opacity: 0; /* Start hidden */
    }
    .animate-fade-down {
        animation: fadeInDown 0.6s ease-out forwards;
        opacity: 0; /* Start hidden */
    }
    /* Stagger delays */
    .delay-100 { animation-delay: 100ms; }
    .delay-200 { animation-delay: 200ms; }
    .delay-300 { animation-delay: 300ms; }
    .delay-400 { animation-delay: 400ms; }
</style>

<div class="min-h-screen bg-gray-50/50">
    <main class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-20">
        
        <div class="mb-8 animate-fade-down">
            <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6">
                
                <div class="flex-1">
                    <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Dashboard</h1>
                    <p class="mt-2 text-sm text-gray-500">
                        Welcome back, <span class="font-semibold text-gray-800">{{ user_name }}</span>. Here is your property overview.
                    </p>
                </div>

                <div class="flex flex-col sm:flex-row items-center gap-3 bg-white p-2 rounded-xl border border-gray-200 shadow-sm transition-shadow hover:shadow-md">
                    
                    <div class="flex items-center gap-2 w-full sm:w-auto">
                        
                        <div class="relative group w-full sm:w-auto">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-4 w-4 text-gray-400 group-focus-within:text-sky-500 transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <input type="date" id="startDate" name="start_date" 
                                   value="{{ start_date|date:'Y-m-d' }}"
                                   class="pl-9 pr-3 py-2 block w-full text-sm font-medium text-gray-700 bg-gray-50 border-0 rounded-lg ring-1 ring-gray-200 focus:ring-2 focus:ring-sky-500 focus:bg-white transition-all duration-200 outline-none cursor-pointer placeholder-gray-400"
                                   title="Start Date">
                        </div>

                        <span class="text-gray-400 font-medium px-1">-</span>

                        <div class="relative group w-full sm:w-auto">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-4 w-4 text-gray-400 group-focus-within:text-sky-500 transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <input type="date" id="endDate" name="end_date"
                                   value="{{ end_date|date:'Y-m-d' }}"
                                   class="pl-9 pr-3 py-2 block w-full text-sm font-medium text-gray-700 bg-gray-50 border-0 rounded-lg ring-1 ring-gray-200 focus:ring-2 focus:ring-sky-500 focus:bg-white transition-all duration-200 outline-none cursor-pointer"
                                   title="End Date">
                        </div>
                    </div>

                    <button id="loadDashboardBtn" onclick="loadDashboardByDateRange()" 
                            class="w-full sm:w-auto flex items-center justify-center gap-2 px-5 py-2 text-sm font-semibold text-white bg-sky-600 rounded-lg hover:bg-sky-700 hover:shadow-lg active:scale-95 transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500">
                        <span>Filter Data</span>
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="space-y-8">
            
            <section class="w-full animate-fade-up delay-100">
                {% include 'dashboard/components/stats_cards.html' %}
            </section>
            
            <section class="w-full animate-fade-up delay-200">
                {% include 'dashboard/components/secondary_stats.html' %}
            </section>
            
            <section class="w-full bg-white rounded-2xl shadow-sm border border-gray-100 p-1 animate-fade-up delay-300 hover:shadow-md transition-shadow duration-300">
                {% include 'dashboard/components/charts_section.html' %}
            </section>
            
            <section class="w-full animate-fade-up delay-300">
                {% include 'dashboard/components/department_performance.html' %}
            </section>
            
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 animate-fade-up delay-400">
                <div class="xl:col-span-2 space-y-4">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Critical Tickets</h3>
                    </div>
                    <div class="hover:translate-y-[-2px] transition-transform duration-300">
                        {% include 'dashboard/components/critical_tickets.html' %}
                    </div>
                </div>
                
                <div class="xl:col-span-1 space-y-4">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Guest Feedback</h3>
                    </div>
                    <div class="hover:translate-y-[-2px] transition-transform duration-300">
                        {% include 'dashboard/components/guest_feedback.html' %}
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
{% endblock content %}

{% block extra_js %}
<script>
    window.loadDashboardByDateRange = function() {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const btn = document.getElementById('loadDashboardBtn');
        
        if (!startDate || !endDate) {
            alert('Please select both start and end dates.');
            return;
        }
        
        if (new Date(startDate) > new Date(endDate)) {
            alert('Start date cannot be after end date.');
            return;
        }
        
        // Add loading state to button
        btn.innerHTML = '<svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Loading...';
        btn.disabled = true;
        btn.classList.add('opacity-75', 'cursor-not-allowed');

        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('start_date', startDate);
        currentUrl.searchParams.set('end_date', endDate);
        window.location.href = currentUrl.toString();
    };
</script>
{% endblock extra_js %} 