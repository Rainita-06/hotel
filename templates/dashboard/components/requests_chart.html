<div class="w-full h-96 bg-white rounded-xl shadow-md border border-gray-200 p-5">
    <div class="text-gray-900 text-lg font-semibold mb-4 font-['Inter']">Requests by Family</div>
    <canvas id="requests-chart" class="w-full h-72"></canvas>
</div>

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Try to parse data provided by the view; fall back to sample data if parsing fails
    let parsed;
    try {
        parsed = JSON.parse('{{ requests_data|escapejs }}');
    } catch (e) {
        parsed = {
            labels: ["Housekeeping", "Maintenance", "Concierge", "F&B", "IT Support", "Other"],
            values: [95, 75, 45, 35, 25, 15]
        };
    }

    const labels = parsed.labels || [];
    const values = parsed.values || [];

    const ctx = document.getElementById('requests-chart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Number of Requests',
                data: values,
                backgroundColor: '#0EA5E9',
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: { bottom: 30 } }, // extra padding to avoid label cutoff
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#4B5563', stepSize: 10 }
                },
                x: {
                    ticks: {
                        color: '#4B5563',
                        maxRotation: 45,
                        minRotation: 45,
                        autoSkip: false
                    }
                }
            },
            plugins: { legend: { display: false } }
        }
    });
});
</script>
{% endblock %}
