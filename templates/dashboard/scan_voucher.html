{% extends "dashboard/base_dashboard.html" %} {% block dashboard_content %}
<div class="bg-white shadow rounded p-6 max-w-xl mx-auto">
  <h2 class="text-2xl font-bold mb-4 text-center">📷 Scan Voucher</h2>

  <div class="flex justify-center">
    <div id="reader" class="rounded border shadow" style="width: 320px"></div>
  </div>

  <div id="result" class="mt-4 text-center text-lg font-semibold text-gray-700">
    Waiting for scan...
  </div>
</div>

<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script>
  const qrScanner = new Html5Qrcode("reader");

  qrScanner.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    (decodedText) => {
      fetch(`/vouchers/validate/?code=${decodedText}`)
        .then((res) => res.json())
        .then((data) => {
          const resultBox = document.getElementById("result");
          if (data.status === "success") {
            resultBox.innerHTML = `<span class="text-green-600">✅ ${
              data.message || "Voucher Valid"
            }<br>Guest: ${data.guest}<br>Room: ${data.room}</span>`;
          } else {
            resultBox.innerHTML = `<span class="text-red-600">❌ ${data.message}</span>`;
          }
        })
        .catch(() => {
          document.getElementById("result").innerHTML =
            '<span class="text-red-600">⚠️ Error validating voucher</span>';
        });
    }
  );
</script>
{% endblock %}
